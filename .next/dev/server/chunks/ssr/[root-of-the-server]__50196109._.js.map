{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lucas/Desktop/Proyectos%202/JobTracker/frontend/src/lib/apiClient.ts"],"sourcesContent":["// Centralized HTTP client used across the app.\n// Enforces cookies on every request and notifies a global handler on 401s.\n\nconst API_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3000';\n\ntype UnauthorizedHandler = () => void | Promise<void>;\n\nlet unauthorizedHandler: UnauthorizedHandler | null = null;\n\nexport function setUnauthorizedHandler(handler: UnauthorizedHandler | null) {\n  unauthorizedHandler = handler;\n}\n\nexport class ApiError extends Error {\n  status?: number;\n  data?: unknown;\n}\n\nexport type ApiFetchOptions = RequestInit & {\n  skipAuthHandling?: boolean;\n};\n\nfunction buildUrl(path: string) {\n  if (path.startsWith('http')) return path;\n  return `${API_URL}${path}`;\n}\n\nfunction mergeHeaders(base?: HeadersInit, extra?: HeadersInit): Headers {\n  const headers = new Headers(base);\n  if (extra) {\n    new Headers(extra).forEach((value, key) => {\n      headers.set(key, value);\n    });\n  }\n  return headers;\n}\n\nfunction parseBody(text: string) {\n  if (!text) return null;\n  try {\n    return JSON.parse(text);\n  } catch {\n    return text;\n  }\n}\n\nexport async function apiFetch<T = unknown>(\n  path: string,\n  options: ApiFetchOptions = {},\n): Promise<T> {\n  const { skipAuthHandling, headers, ...init } = options;\n\n  const response = await fetch(buildUrl(path), {\n    credentials: 'include',\n    cache: 'no-store',\n    headers: mergeHeaders({ 'Content-Type': 'application/json' }, headers),\n    ...init,\n  });\n\n  const rawBody = await response.text();\n  const data = parseBody(rawBody);\n\n  if (response.status === 401 && !skipAuthHandling && unauthorizedHandler) {\n    await unauthorizedHandler();\n  }\n\n  if (!response.ok) {\n    const message =\n      typeof data === 'string'\n        ? data\n        : (data as { message?: string })?.message || 'Error en la solicitud';\n    const error = new ApiError(message);\n    error.status = response.status;\n    error.data = data;\n    throw error;\n  }\n\n  return data as T;\n}\n\nexport { API_URL };\n"],"names":[],"mappings":"AAAA,+CAA+C;AAC/C,2EAA2E;;;;;;;;;;;AAE3E,MAAM,UAAU,6DAAmC;AAInD,IAAI,sBAAkD;AAE/C,SAAS,uBAAuB,OAAmC;IACxE,sBAAsB;AACxB;AAEO,MAAM,iBAAiB;IAC5B,OAAgB;IAChB,KAAe;AACjB;AAMA,SAAS,SAAS,IAAY;IAC5B,IAAI,KAAK,UAAU,CAAC,SAAS,OAAO;IACpC,OAAO,GAAG,UAAU,MAAM;AAC5B;AAEA,SAAS,aAAa,IAAkB,EAAE,KAAmB;IAC3D,MAAM,UAAU,IAAI,QAAQ;IAC5B,IAAI,OAAO;QACT,IAAI,QAAQ,OAAO,OAAO,CAAC,CAAC,OAAO;YACjC,QAAQ,GAAG,CAAC,KAAK;QACnB;IACF;IACA,OAAO;AACT;AAEA,SAAS,UAAU,IAAY;IAC7B,IAAI,CAAC,MAAM,OAAO;IAClB,IAAI;QACF,OAAO,KAAK,KAAK,CAAC;IACpB,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,eAAe,SACpB,IAAY,EACZ,UAA2B,CAAC,CAAC;IAE7B,MAAM,EAAE,gBAAgB,EAAE,OAAO,EAAE,GAAG,MAAM,GAAG;IAE/C,MAAM,WAAW,MAAM,MAAM,SAAS,OAAO;QAC3C,aAAa;QACb,OAAO;QACP,SAAS,aAAa;YAAE,gBAAgB;QAAmB,GAAG;QAC9D,GAAG,IAAI;IACT;IAEA,MAAM,UAAU,MAAM,SAAS,IAAI;IACnC,MAAM,OAAO,UAAU;IAEvB,IAAI,SAAS,MAAM,KAAK,OAAO,CAAC,oBAAoB,qBAAqB;QACvE,MAAM;IACR;IAEA,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,UACJ,OAAO,SAAS,WACZ,OACA,AAAC,MAA+B,WAAW;QACjD,MAAM,QAAQ,IAAI,SAAS;QAC3B,MAAM,MAAM,GAAG,SAAS,MAAM;QAC9B,MAAM,IAAI,GAAG;QACb,MAAM;IACR;IAEA,OAAO;AACT"}},
    {"offset": {"line": 99, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lucas/Desktop/Proyectos%202/JobTracker/frontend/src/contexts/AuthContext.tsx"],"sourcesContent":["'use client';\n\nimport { useRouter, usePathname } from 'next/navigation';\nimport {\n  createContext,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useState,\n  type ReactNode,\n} from 'react';\nimport { apiFetch, setUnauthorizedHandler } from '../lib/apiClient';\nimport { AuthUser } from '../types/auth';\n\ntype AuthContextValue = {\n  user: AuthUser | null;\n  isAuthenticated: boolean;\n  isLoadingSession: boolean;\n  login: (email: string, password: string, redirectTo?: string) => Promise<void>;\n  logout: () => Promise<void>;\n  refreshSession: () => Promise<void>;\n};\n\nconst AuthContext = createContext<AuthContextValue | undefined>(undefined);\n\nfunction useAuthContext() {\n  const ctx = useContext(AuthContext);\n  if (!ctx) {\n    throw new Error('useAuth debe usarse dentro de un AuthProvider');\n  }\n  return ctx;\n}\n\ntype MeResponse = AuthUser;\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const [user, setUser] = useState<AuthUser | null>(null);\n  const [isLoadingSession, setIsLoadingSession] = useState(true);\n  const router = useRouter();\n  const pathname = usePathname();\n\n  const handleUnauthorized = useCallback(async () => {\n    // Session expired or invalid: clear client state and bounce to login.\n    setUser(null);\n    setIsLoadingSession(false);\n    const currentPath =\n      typeof window !== 'undefined'\n        ? `${window.location.pathname}${window.location.search}`\n        : pathname;\n    if (!pathname.startsWith('/login')) {\n      router.push(`/login?redirectTo=${encodeURIComponent(currentPath)}`);\n    }\n  }, [pathname, router]);\n\n  useEffect(() => {\n    setUnauthorizedHandler(handleUnauthorized);\n    return () => setUnauthorizedHandler(null);\n  }, [handleUnauthorized]);\n\n  const fetchCurrentUser = useCallback(async () => {\n    const me = await apiFetch<MeResponse>('/auth/me');\n    setUser(me);\n  }, []);\n\n  useEffect(() => {\n    let cancelled = false;\n\n    async function bootstrap() {\n      try {\n        await fetchCurrentUser();\n      } catch (error) {\n        if (!cancelled) {\n          setUser(null);\n        }\n      } finally {\n        if (!cancelled) {\n          setIsLoadingSession(false);\n        }\n      }\n    }\n\n    void bootstrap();\n\n    return () => {\n      cancelled = true;\n    };\n  }, [fetchCurrentUser]);\n\n  const login = useCallback(\n    async (email: string, password: string, redirectTo = '/dashboard') => {\n      await apiFetch('/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({ email, password }),\n      });\n      await fetchCurrentUser();\n      router.push(redirectTo);\n    },\n    [fetchCurrentUser, router],\n  );\n\n  const logout = useCallback(async () => {\n    try {\n      await apiFetch('/auth/logout', { method: 'POST' });\n    } finally {\n      setUser(null);\n      router.push('/login');\n    }\n  }, [router]);\n\n  const refreshSession = useCallback(async () => {\n    await fetchCurrentUser();\n  }, [fetchCurrentUser]);\n\n  const value = useMemo<AuthContextValue>(\n    () => ({\n      user,\n      isAuthenticated: Boolean(user),\n      isLoadingSession,\n      login,\n      logout,\n      refreshSession,\n    }),\n    [isLoadingSession, login, logout, refreshSession, user],\n  );\n\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\n}\n\nexport function useAuth() {\n  return useAuthContext();\n}\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;AASA;AAZA;;;;;AAwBA,MAAM,4BAAc,IAAA,sNAAa,EAA+B;AAEhE,SAAS;IACP,MAAM,MAAM,IAAA,mNAAU,EAAC;IACvB,IAAI,CAAC,KAAK;QACR,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT;AAIO,SAAS,aAAa,EAAE,QAAQ,EAA2B;IAChE,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAkB;IAClD,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,iNAAQ,EAAC;IACzD,MAAM,SAAS,IAAA,+IAAS;IACxB,MAAM,WAAW,IAAA,iJAAW;IAE5B,MAAM,qBAAqB,IAAA,oNAAW,EAAC;QACrC,sEAAsE;QACtE,QAAQ;QACR,oBAAoB;QACpB,MAAM,cACJ,sCACI,0BACA;QACN,IAAI,CAAC,SAAS,UAAU,CAAC,WAAW;YAClC,OAAO,IAAI,CAAC,CAAC,kBAAkB,EAAE,mBAAmB,cAAc;QACpE;IACF,GAAG;QAAC;QAAU;KAAO;IAErB,IAAA,kNAAS,EAAC;QACR,IAAA,iJAAsB,EAAC;QACvB,OAAO,IAAM,IAAA,iJAAsB,EAAC;IACtC,GAAG;QAAC;KAAmB;IAEvB,MAAM,mBAAmB,IAAA,oNAAW,EAAC;QACnC,MAAM,KAAK,MAAM,IAAA,mIAAQ,EAAa;QACtC,QAAQ;IACV,GAAG,EAAE;IAEL,IAAA,kNAAS,EAAC;QACR,IAAI,YAAY;QAEhB,eAAe;YACb,IAAI;gBACF,MAAM;YACR,EAAE,OAAO,OAAO;gBACd,IAAI,CAAC,WAAW;oBACd,QAAQ;gBACV;YACF,SAAU;gBACR,IAAI,CAAC,WAAW;oBACd,oBAAoB;gBACtB;YACF;QACF;QAEA,KAAK;QAEL,OAAO;YACL,YAAY;QACd;IACF,GAAG;QAAC;KAAiB;IAErB,MAAM,QAAQ,IAAA,oNAAW,EACvB,OAAO,OAAe,UAAkB,aAAa,YAAY;QAC/D,MAAM,IAAA,mIAAQ,EAAC,eAAe;YAC5B,QAAQ;YACR,MAAM,KAAK,SAAS,CAAC;gBAAE;gBAAO;YAAS;QACzC;QACA,MAAM;QACN,OAAO,IAAI,CAAC;IACd,GACA;QAAC;QAAkB;KAAO;IAG5B,MAAM,SAAS,IAAA,oNAAW,EAAC;QACzB,IAAI;YACF,MAAM,IAAA,mIAAQ,EAAC,gBAAgB;gBAAE,QAAQ;YAAO;QAClD,SAAU;YACR,QAAQ;YACR,OAAO,IAAI,CAAC;QACd;IACF,GAAG;QAAC;KAAO;IAEX,MAAM,iBAAiB,IAAA,oNAAW,EAAC;QACjC,MAAM;IACR,GAAG;QAAC;KAAiB;IAErB,MAAM,QAAQ,IAAA,gNAAO,EACnB,IAAM,CAAC;YACL;YACA,iBAAiB,QAAQ;YACzB;YACA;YACA;YACA;QACF,CAAC,GACD;QAAC;QAAkB;QAAO;QAAQ;QAAgB;KAAK;IAGzD,qBAAO,8OAAC,YAAY,QAAQ;QAAC,OAAO;kBAAQ;;;;;;AAC9C;AAEO,SAAS;IACd,OAAO;AACT"}}]
}